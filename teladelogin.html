<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Meta Tags Essenciais -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="index, follow">
  <meta name="language" content="pt-BR">
  
  <!-- SEO Meta Tags -->
  <title>Booktor - Login | Plataforma de eBooks e Comunidade Literária</title>
  <meta name="description" content="Faça login na Booktor, sua plataforma completa de eBooks gratuitos. Acesse nossa comunidade literária, chat global e biblioteca digital exclusiva.">
  <meta name="keywords" content="login, ebooks, livros digitais, literatura, comunidade literária, booktor, leitura online">
  <meta name="author" content="Alírio Neto">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://booktor.github.io/teladelogin.html">
  <meta property="og:title" content="Booktor - Login | Plataforma de eBooks">
  <meta property="og:description" content="Acesse a Booktor e descubra uma biblioteca digital com eBooks gratuitos e uma comunidade apaixonada por literatura.">
  <meta property="og:image" content="https://booktor.github.io/assets/booktor-logo.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:site_name" content="Booktor">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://booktor.github.io/teladelogin.html">
  <meta property="twitter:title" content="Booktor - Login | Plataforma de eBooks">
  <meta property="twitter:description" content="Acesse a Booktor e descubra uma biblioteca digital com eBooks gratuitos e uma comunidade apaixonada por literatura.">
  <meta property="twitter:image" content="https://booktor.github.io/assets/booktor-logo.png">

  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

  <!-- Favicon -->
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/29/29302.png" type="image/png">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/29/29302.png">
  
  <!-- Preconnect for Performance -->
  <link rel="preconnect" href="https://www.gstatic.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  
  <!-- CSS Externo -->
  <link rel="stylesheet" href="styles/login.css">
  
  <!-- Critical CSS Inline -->
  <style>
    /* Critical CSS para evitar FOUC */
    body { 
      opacity: 0; 
      transition: opacity 0.3s ease;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    .container { visibility: hidden; }
    
    /* Estilos básicos para garantir renderização adequada */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .loading.show {
      opacity: 1;
      visibility: visible;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Booktor - Login",
    "description": "Página de login da plataforma Booktor de eBooks gratuitos",
    "url": "https://booktor.github.io/teladelogin.html",
    "isPartOf": {
      "@type": "WebSite",
      "name": "Booktor",
      "url": "https://booktor.github.io/"
    },
    "potentialAction": {
      "@type": "LoginAction",
      "target": "https://booktor.github.io/teladelogin.html"
    }
  }
  </script>
</head>

<body>
  <!-- Skip Navigation Link para Acessibilidade -->
  <a href="#main-content" class="sr-only">Pular para o conteúdo principal</a>
  
  <!-- Background Particles -->
  <div class="particles" id="particles" aria-hidden="true"></div>

  <!-- Loading State -->
  <div class="loading" id="loading" role="status" aria-label="Carregando">
    <div class="loading-spinner"></div>
    <span class="sr-only">Carregando página de login...</span>
  </div>

  <!-- Main Content -->
  <main class="container" id="main-content">
    <!-- Logo Section -->
    <header class="logo">
      <h1 aria-label="Booktor - Plataforma de eBooks">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
          <path d="M4 2C3.44772 2 3 2.44772 3 3V21C3 21.5523 3.44772 22 4 22H20C20.5523 22 21 21.5523 21 21V7.41421C21 7.149 20.8946 6.89464 20.7071 6.70711L16.2929 2.29289C16.1054 2.10536 15.851 2 15.5858 2H4Z" stroke="currentColor" stroke-width="2"/>
          <path d="M15 2V7H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7 10H17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M7 14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M7 18H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Booktor
      </h1>
      <p>Sistema de Gerenciamento de Usuários</p>
    </header>

    <!-- Tab Navigation -->
    <nav class="tabs" role="tablist" aria-label="Opções de autenticação">
      <button 
        class="tab active" 
        data-tab="login" 
        role="tab"
        aria-selected="true"
        aria-controls="loginForm"
        id="tab-login"
        tabindex="0"
      >
        Entrar
      </button>
      <button 
        class="tab" 
        data-tab="register" 
        role="tab"
        aria-selected="false"
        aria-controls="registerForm"
        id="tab-register"
        tabindex="-1"
      >
        Registrar
      </button>
    </nav>

    <!-- Login Form -->
    <section 
      id="loginForm" 
      class="form-container"
      role="tabpanel"
      aria-labelledby="tab-login"
      aria-hidden="false"
    >
      <form novalidate aria-label="Formulário de login">
        <div class="form-group">
          <label for="loginEmail">Email:</label>
          <input 
            type="email" 
            id="loginEmail" 
            class="form-input" 
            placeholder="seu@email.com" 
            required 
            autocomplete="email"
            aria-describedby="email-error"
            aria-invalid="false"
          >
          <div id="email-error" class="error-message sr-only" role="alert"></div>
        </div>
        
        <div class="form-group" style="position: relative;">
          <label for="loginPassword">Senha:</label>
          <input 
            type="password" 
            id="loginPassword" 
            class="form-input" 
            placeholder="Sua senha" 
            required
            autocomplete="current-password"
            aria-describedby="password-error password-help"
            aria-invalid="false"
          >
          <button 
            type="button" 
            class="password-toggle" 
            onclick="togglePassword('loginPassword')"
            aria-label="Mostrar/Ocultar senha"
            title="Clique para mostrar ou ocultar a senha"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
              <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <div id="password-error" class="error-message sr-only" role="alert"></div>
          <div id="password-help" class="sr-only">Sua senha deve ter pelo menos 6 caracteres</div>
        </div>
        
        <button 
          type="button"
          class="btn" 
          id="loginBtn"
          aria-describedby="login-status"
        >
          Entrar
        </button>
        <div id="login-status" class="sr-only" role="status" aria-live="polite"></div>
      </form>
      
      <div class="divider" aria-hidden="true">
        <span>ou</span>
      </div>
      
      <button 
        class="google-btn" 
        id="googleLoginBtn"
        aria-label="Entrar com conta do Google"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        Entrar com Google
      </button>
      
      <div class="forgot-password">
        <a 
          href="#" 
          id="forgotPasswordLink"
          aria-label="Recuperar senha esquecida"
        >
          Esqueceu sua senha?
        </a>
      </div>
    </section>

    <!-- Register Form -->
    <section 
      id="registerForm" 
      class="form-container hidden"
      role="tabpanel"
      aria-labelledby="tab-register"
      aria-hidden="true"
    >
      <form novalidate aria-label="Formulário de registro">
        <div class="form-group">
          <label for="registerName">Nome completo:</label>
          <input 
            type="text" 
            id="registerName" 
            class="form-input" 
            placeholder="Seu nome completo" 
            required
            autocomplete="name"
            aria-describedby="name-error"
            aria-invalid="false"
            minlength="2"
          >
          <div id="name-error" class="error-message sr-only" role="alert"></div>
        </div>
        
        <div class="form-group">
          <label for="registerEmail">Email:</label>
          <input 
            type="email" 
            id="registerEmail" 
            class="form-input" 
            placeholder="seu@email.com" 
            required
            autocomplete="email"
            aria-describedby="register-email-error"
            aria-invalid="false"
          >
          <div id="register-email-error" class="error-message sr-only" role="alert"></div>
        </div>
        
        <div class="form-group" style="position: relative;">
          <label for="registerPassword">Senha:</label>
          <input 
            type="password" 
            id="registerPassword" 
            class="form-input" 
            placeholder="Mínimo 6 caracteres" 
            required
            autocomplete="new-password"
            aria-describedby="register-password-error register-password-help"
            aria-invalid="false"
            minlength="6"
          >
          <button 
            type="button" 
            class="password-toggle" 
            onclick="togglePassword('registerPassword')"
            aria-label="Mostrar/Ocultar senha"
            title="Clique para mostrar ou ocultar a senha"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
              <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <div id="register-password-error" class="error-message sr-only" role="alert"></div>
          <div id="register-password-help" class="sr-only">A senha deve ter pelo menos 6 caracteres</div>
        </div>
        
        <div class="form-group" style="position: relative;">
          <label for="confirmPassword">Confirmar Senha:</label>
          <input 
            type="password" 
            id="confirmPassword" 
            class="form-input" 
            placeholder="Confirme sua senha" 
            required
            autocomplete="new-password"
            aria-describedby="confirm-password-error"
            aria-invalid="false"
          >
          <button 
            type="button" 
            class="password-toggle" 
            onclick="togglePassword('confirmPassword')"
            aria-label="Mostrar/Ocultar confirmação de senha"
            title="Clique para mostrar ou ocultar a confirmação da senha"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
              <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <div id="confirm-password-error" class="error-message sr-only" role="alert"></div>
        </div>
        
        <button 
          type="button"
          class="btn" 
          id="registerBtn"
          aria-describedby="register-status"
        >
          Registrar
        </button>
        <div id="register-status" class="sr-only" role="status" aria-live="polite"></div>
      </form>
      
      <div class="divider" aria-hidden="true">
        <span>ou</span>
      </div>
      
      <button 
        class="google-btn" 
        id="googleRegisterBtn"
        aria-label="Registrar com conta do Google"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        Registrar com Google
      </button>
    </section>

    <!-- Reset Password Form -->
    <section 
      id="resetPasswordForm" 
      class="form-container hidden"
      role="form"
      aria-label="Formulário de recuperação de senha"
    >
      <form novalidate>
        <div class="form-group">
          <label for="resetEmail">Email para recuperação:</label>
          <input 
            type="email" 
            id="resetEmail" 
            class="form-input" 
            placeholder="seu@email.com" 
            required
            autocomplete="email"
            aria-describedby="reset-email-error reset-email-help"
            aria-invalid="false"
          >
          <div id="reset-email-error" class="error-message sr-only" role="alert"></div>
          <div id="reset-email-help" class="sr-only">Enviaremos um link para redefinir sua senha</div>
        </div>
        
        <button 
          type="button"
          class="btn" 
          id="resetBtn"
          aria-describedby="reset-status"
        >
          Enviar Link de Recuperação
        </button>
        <div id="reset-status" class="sr-only" role="status" aria-live="polite"></div>
      </form>
      
      <div class="forgot-password">
        <a 
          href="#" 
          id="backToLoginLink"
          aria-label="Voltar para a página de login"
        >
          Voltar ao Login
        </a>
      </div>
    </section>
  </main>

  <!-- JavaScript - Carregado de forma assíncrona -->
  <script type="module" defer>
    // Firebase Configuration
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signInWithPopup,
      GoogleAuthProvider,
      sendPasswordResetEmail,
      updateProfile,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getDatabase,
      ref,
      set,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBauGgt1pm-sBas75N40ufWRsGD6c4BsgM",
      authDomain: "sistema-de-login-blog.firebaseapp.com",
      databaseURL: "https://sistema-de-login-blog-default-rtdb.firebaseio.com",
      projectId: "sistema-de-login-blog",
      storageBucket: "sistema-de-login-blog.firebasestorage.app",
      messagingSenderId: "416120877008",
      appId: "1:416120877008:web:a5b0a26bec246d577a93d5"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);
    const provider = new GoogleAuthProvider();

    // DOM Elements Cache
    const elements = {
      loading: document.getElementById('loading'),
      tabs: document.querySelectorAll('.tab'),
      forms: {
        login: document.getElementById('loginForm'),
        register: document.getElementById('registerForm'),
        reset: document.getElementById('resetPasswordForm')
      },
      buttons: {
        login: document.getElementById('loginBtn'),
        register: document.getElementById('registerBtn'),
        reset: document.getElementById('resetBtn'),
        googleLogin: document.getElementById('googleLoginBtn'),
        googleRegister: document.getElementById('googleRegisterBtn'),
        forgotPassword: document.getElementById('forgotPasswordLink'),
        backToLogin: document.getElementById('backToLoginLink')
      },
      inputs: {
        loginEmail: document.getElementById('loginEmail'),
        loginPassword: document.getElementById('loginPassword'),
        registerName: document.getElementById('registerName'),
        registerEmail: document.getElementById('registerEmail'),
        registerPassword: document.getElementById('registerPassword'),
        confirmPassword: document.getElementById('confirmPassword'),
        resetEmail: document.getElementById('resetEmail')
      }
    };

    // Utility Functions
    const UIController = {
      showLoading() {
        elements.loading.classList.add('show');
        elements.loading.setAttribute('aria-hidden', 'false');
      },

      hideLoading() {
        elements.loading.classList.remove('show');
        elements.loading.setAttribute('aria-hidden', 'true');
      },

      showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        document.body.appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 100);
        
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 4000);
      },

      showError(inputElement, message) {
        const errorElement = document.getElementById(inputElement.getAttribute('aria-describedby').split(' ')[0]);
        if (errorElement) {
          errorElement.textContent = message;
          errorElement.classList.remove('sr-only');
          inputElement.setAttribute('aria-invalid', 'true');
        }
      },

      clearError(inputElement) {
        const errorElement = document.getElementById(inputElement.getAttribute('aria-describedby').split(' ')[0]);
        if (errorElement) {
          errorElement.textContent = '';
          errorElement.classList.add('sr-only');
          inputElement.setAttribute('aria-invalid', 'false');
        }
      }
    };

    // Validation Functions
    const Validator = {
      email(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      },

      password(password) {
        return password.length >= 6;
      },

      name(name) {
        return name.trim().length >= 2;
      }
    };

    // Password Toggle Function
    window.togglePassword = function(inputId) {
      const input = document.getElementById(inputId);
      const button = input.nextElementSibling;
      const eyeIcon = button.querySelector('svg');
      
      if (input.type === 'password') {
        input.type = 'text';
        button.setAttribute('aria-label', 'Ocultar senha');
        // SVG para olho fechado
        eyeIcon.innerHTML = `
          <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C5 20 1 12 1 12A13.16 13.16 0 0 1 5.06 6.06L17.94 17.94Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
        `;
      } else {
        input.type = 'password';
        button.setAttribute('aria-label', 'Mostrar senha');
        // SVG para olho aberto
        eyeIcon.innerHTML = `
          <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
        `;
      }
    };

    // Tab Navigation
    function switchTab(tabName) {
      elements.tabs.forEach(tab => {
        tab.classList.remove('active');
        tab.setAttribute('aria-selected', 'false');
        tab.setAttribute('tabindex', '-1');
      });
      
      Object.values(elements.forms).forEach(form => {
        form.classList.add('hidden');
        form.setAttribute('aria-hidden', 'true');
      });

      const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
      const activeForm = elements.forms[tabName];
      
      if (activeTab && activeForm) {
        activeTab.classList.add('active');
        activeTab.setAttribute('aria-selected', 'true');
        activeTab.setAttribute('tabindex', '0');
        activeForm.classList.remove('hidden');
        activeForm.setAttribute('aria-hidden', 'false');
      }
    }

    // Event Listeners
    elements.tabs.forEach(tab => {
      tab.addEventListener('click', (e) => switchTab(e.target.dataset.tab));
      tab.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          switchTab(e.target.dataset.tab);
        }
      });
    });

    // Authentication Functions
    const AuthController = {
      async login() {
        const email = elements.inputs.loginEmail.value.trim();
        const password = elements.inputs.loginPassword.value;

        // Clear previous errors
        UIController.clearError(elements.inputs.loginEmail);
        UIController.clearError(elements.inputs.loginPassword);

        // Validation
        if (!email) {
          UIController.showError(elements.inputs.loginEmail, 'Email é obrigatório');
          elements.inputs.loginEmail.focus();
          return;
        }

        if (!Validator.email(email)) {
          UIController.showError(elements.inputs.loginEmail, 'Email inválido');
          elements.inputs.loginEmail.focus();
          return;
        }

        if (!password) {
          UIController.showError(elements.inputs.loginPassword, 'Senha é obrigatória');
          elements.inputs.loginPassword.focus();
          return;
        }

        UIController.showLoading();

        try {
          await signInWithEmailAndPassword(auth, email, password);
          UIController.showToast('Login realizado com sucesso!', 'success');
          document.getElementById('login-status').textContent = 'Login realizado com sucesso';
          
          setTimeout(() => {
            window.location.href = 'inicio.html';
          }, 1500);
        } catch (error) {
          UIController.hideLoading();
          console.error('Erro no login:', error);
          
          let errorMessage = 'Erro no login. Tente novamente.';
          if (error.code === 'auth/user-not-found') {
            errorMessage = 'Usuário não encontrado';
          } else if (error.code === 'auth/wrong-password') {
            errorMessage = 'Senha incorreta';
          } else if (error.code === 'auth/invalid-email') {
            errorMessage = 'Email inválido';
          }
          
          UIController.showToast(errorMessage, 'error');
          document.getElementById('login-status').textContent = errorMessage;
        }
      },

      async register() {
        const name = elements.inputs.registerName.value.trim();
        const email = elements.inputs.registerEmail.value.trim();
        const password = elements.inputs.registerPassword.value;
        const confirmPassword = elements.inputs.confirmPassword.value;

        // Clear previous errors
        UIController.clearError(elements.inputs.registerName);
        UIController.clearError(elements.inputs.registerEmail);
        UIController.clearError(elements.inputs.registerPassword);
        UIController.clearError(elements.inputs.confirmPassword);

        // Validation
        if (!name) {
          UIController.showError(elements.inputs.registerName, 'Nome é obrigatório');
          elements.inputs.registerName.focus();
          return;
        }

        if (!Validator.name(name)) {
          UIController.showError(elements.inputs.registerName, 'Nome deve ter pelo menos 2 caracteres');
          elements.inputs.registerName.focus();
          return;
        }

        if (!email) {
          UIController.showError(elements.inputs.registerEmail, 'Email é obrigatório');
          elements.inputs.registerEmail.focus();
          return;
        }

        if (!Validator.email(email)) {
          UIController.showError(elements.inputs.registerEmail, 'Email inválido');
          elements.inputs.registerEmail.focus();
          return;
        }

        if (!password) {
          UIController.showError(elements.inputs.registerPassword, 'Senha é obrigatória');
          elements.inputs.registerPassword.focus();
          return;
        }

        if (!Validator.password(password)) {
          UIController.showError(elements.inputs.registerPassword, 'Senha deve ter pelo menos 6 caracteres');
          elements.inputs.registerPassword.focus();
          return;
        }

        if (password !== confirmPassword) {
          UIController.showError(elements.inputs.confirmPassword, 'Senhas não coincidem');
          elements.inputs.confirmPassword.focus();
          return;
        }

        UIController.showLoading();

        try {
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          await updateProfile(userCredential.user, { displayName: name });
          
          // Save user data to database
          await set(ref(database, `users/${userCredential.user.uid}`), {
            uid: userCredential.user.uid,
            displayName: name,
            email: email,
            createdAt: serverTimestamp()
          });

          UIController.showToast('Conta criada com sucesso!', 'success');
          document.getElementById('register-status').textContent = 'Conta criada com sucesso';
          
          setTimeout(() => {
            window.location.href = 'inicio.html';
          }, 1500);
        } catch (error) {
          UIController.hideLoading();
          console.error('Erro no registro:', error);
          
          let errorMessage = 'Erro ao criar conta. Tente novamente.';
          if (error.code === 'auth/email-already-in-use') {
            errorMessage = 'Email já está em uso';
          } else if (error.code === 'auth/weak-password') {
            errorMessage = 'Senha muito fraca';
          } else if (error.code === 'auth/invalid-email') {
            errorMessage = 'Email inválido';
          }
          
          UIController.showToast(errorMessage, 'error');
          document.getElementById('register-status').textContent = errorMessage;
        }
      },

      async googleAuth() {
        UIController.showLoading();
        try {
          const result = await signInWithPopup(auth, provider);
          
          await set(ref(database, `users/${result.user.uid}`), {
            uid: result.user.uid,
            displayName: result.user.displayName,
            email: result.user.email,
            photoURL: result.user.photoURL,
            lastLogin: serverTimestamp()
          });

          UIController.showToast('Login com Google realizado com sucesso!', 'success');
          
          setTimeout(() => {
            window.location.href = 'inicio.html';
          }, 1500);
        } catch (error) {
          UIController.hideLoading();
          console.error('Erro no login com Google:', error);
          UIController.showToast('Erro no login com Google. Tente novamente.', 'error');
        }
      },

      async resetPassword() {
        const email = elements.inputs.resetEmail.value.trim();

        UIController.clearError(elements.inputs.resetEmail);

        if (!email) {
          UIController.showError(elements.inputs.resetEmail, 'Email é obrigatório');
          elements.inputs.resetEmail.focus();
          return;
        }

        if (!Validator.email(email)) {
          UIController.showError(elements.inputs.resetEmail, 'Email inválido');
          elements.inputs.resetEmail.focus();
          return;
        }

        UIController.showLoading();

        try {
          await sendPasswordResetEmail(auth, email);
          UIController.hideLoading();
          UIController.showToast('Link de recuperação enviado!', 'success');
          document.getElementById('reset-status').textContent = 'Link de recuperação enviado para seu email';
          
          setTimeout(() => switchTab('login'), 2000);
        } catch (error) {
          UIController.hideLoading();
          console.error('Erro ao enviar email de recuperação:', error);
          
          let errorMessage = 'Erro ao enviar email. Verifique o endereço.';
          if (error.code === 'auth/user-not-found') {
            errorMessage = 'Email não encontrado';
          }
          
          UIController.showToast(errorMessage, 'error');
          document.getElementById('reset-status').textContent = 'Erro ao enviar email de recuperação';
        }
      }
    };

    // Button Event Listeners
    elements.buttons.login.addEventListener('click', AuthController.login);
    elements.buttons.register.addEventListener('click', AuthController.register);
    elements.buttons.reset.addEventListener('click', AuthController.resetPassword);
    
    [elements.buttons.googleLogin, elements.buttons.googleRegister].forEach(btn => {
      btn.addEventListener('click', AuthController.googleAuth);
    });

    elements.buttons.forgotPassword.addEventListener('click', (e) => {
      e.preventDefault();
      switchTab('reset');
    });

    elements.buttons.backToLogin.addEventListener('click', (e) => {
      e.preventDefault();
      switchTab('login');
    });

    // Particles System
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      const particleCount = window.innerWidth < 768 ? 20 : 40;
      
      particlesContainer.innerHTML = '';
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 6 + 's';
        particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
        particlesContainer.appendChild(particle);
      }
    }

    // Auth State Observer
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log('Usuário já autenticado, redirecionando...');
        window.location.href = 'inicio.html';
      }
    });

    // Initialize Application
    function initializeApp() {
      UIController.hideLoading();
      createParticles();
      
      // Show content after initialization
      document.body.style.opacity = '1';
      document.querySelector('.container').style.visibility = 'visible';
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', initializeApp);

    window.addEventListener('resize', createParticles);

    // Form submission with Enter key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const activeForm = document.querySelector('.form-container:not(.hidden)');
        if (activeForm) {
          const submitBtn = activeForm.querySelector('.btn');
          if (submitBtn) {
            submitBtn.click();
          }
        }
      }
    });

    // Performance optimization: Debounce resize events
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(createParticles, 250);
    });
  </script>
</body>
</html>
